import{u as K,k as G,e as O,o as z,r as k,t as _,j as e,B as l,s as m,q,n as S,_ as R}from"./index-F_r_DwTH.js";import{u as W,a as J,d as U,L as n}from"./label-BnG0ayX7.js";import{a as X,u as Y,T as Z,M as ee}from"./top-nav-DvRblSZy.js";import{I as u}from"./input-DMn3TbYb.js";import{T as P}from"./textarea-G6A4affv.js";import{C as se,a as te,b as ae,d as ie}from"./card-BV_eUoeD.js";import{S as A,a as M,b as Q,c as I,d as f}from"./select-DGKpCF8p.js";import{H as ne,S as le,T as re,C as oe,P as ce}from"./config-drawer-BpM_6BIu.js";import{q as de}from"./questions-api-Dx8S8AIK.js";import{m as me}from"./modules-api-Dus87-JM.js";import{c as y}from"./createLucideIcon-C0SHlZwQ.js";import{P as T}from"./plus-Bql6OQ1N.js";import"./sign-out-dialog-XajWXyhp.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],ue=y("arrow-left",he);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=[["path",{d:"M5 12h14",key:"1ays0h"}]],F=y("minus",xe);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],je=y("save",pe),ge=z({label:m().min(1,"Label is required"),content_markdown:m().min(1,"Content is required")}),we=z({title:m().min(1,"Title is required").max(200,"Title must be less than 200 characters"),type:R(["mcq","fill_blank"]),content_markdown:m().min(1,"Content is required").max(5e3,"Content must be less than 5000 characters"),position:S().min(1,"Position must be at least 1"),module_id:S().min(1,"Module is required"),choices:q(ge).optional(),answer:q(m().min(1,"Answer cannot be empty")).min(1,"At least one answer is required"),explanation_markdown:m().max(2e3,"Explanation must be less than 2000 characters").optional()}).refine(r=>!(r.type==="mcq"&&(!r.choices||r.choices.length===0)),{message:"Multiple choice questions require choices",path:["choices"]});function be(){const r=K(),h=G({strict:!1}),v=O(),{register:o,handleSubmit:V,formState:{errors:a},setValue:c,watch:j,control:E}=W({resolver:J(we),defaultValues:{position:1,module_id:h.moduleId?parseInt(h.moduleId):void 0,choices:[{label:"A",content_markdown:""},{label:"B",content_markdown:""},{label:"C",content_markdown:""},{label:"D",content_markdown:""}],answer:[""]}}),{fields:g,append:H,remove:B}=U({control:E,name:"choices"}),[d,w]=k.useState([""]),b=j("type"),N=j("module_id"),{data:L=[]}=X({queryKey:["modules"],queryFn:()=>me.list()});k.useEffect(()=>{h.moduleId&&c("module_id",parseInt(h.moduleId))},[h.moduleId,c]);const t=Y({mutationFn:s=>de.create(s),onSuccess:(s,i)=>{_.success(`Question "${s.title}" created successfully!`),v.invalidateQueries({queryKey:["questions"]}),v.invalidateQueries({queryKey:["module-questions"]}),r({to:"/tests/questions",search:{moduleId:i.module_id.toString()}})},onError:s=>{const i=s?.response?.data?.detail||"Failed to create question. Please try again.";_.error(i)}}),$=s=>{const i={...s,answer:d,choices:s.type==="mcq"?s.choices||[]:null};t.mutate(i)},C=()=>{r({to:"/tests/questions",search:N?{moduleId:N.toString()}:{}})};return e.jsxs(e.Fragment,{children:[e.jsxs(ne,{children:[e.jsx(Z,{links:fe}),e.jsxs("div",{className:"ms-auto flex items-center space-x-4",children:[e.jsx(le,{}),e.jsx(re,{}),e.jsx(oe,{}),e.jsx(ce,{})]})]}),e.jsxs(ee,{children:[e.jsx("div",{className:"mb-6 flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(l,{variant:"ghost",size:"sm",onClick:C,disabled:t.isPending,children:[e.jsx(ue,{className:"h-4 w-4 mr-2"}),"Back to Questions"]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight bg-gradient-to-r from-primary to-primary/70 bg-clip-text text-transparent",children:"Create New Question"}),e.jsx("p",{className:"text-muted-foreground text-lg",children:"Create a new test question with multiple choice or fill-in-the-blank format"})]})]})}),e.jsxs(se,{className:"max-w-4xl",children:[e.jsx(te,{children:e.jsx(ae,{children:"Question Details"})}),e.jsx(ie,{children:e.jsxs("form",{onSubmit:V($),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"title",children:"Question Title *"}),e.jsx(u,{id:"title",placeholder:"Grammar Question 1",...o("title"),disabled:t.isPending}),a.title&&e.jsx("p",{className:"text-sm text-destructive",children:a.title.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"type",children:"Question Type *"}),e.jsxs(A,{value:b,onValueChange:s=>c("type",s),disabled:t.isPending,children:[e.jsx(M,{children:e.jsx(Q,{placeholder:"Select question type"})}),e.jsxs(I,{children:[e.jsx(f,{value:"mcq",children:"Multiple Choice"}),e.jsx(f,{value:"fill_blank",children:"Fill in the Blank"})]})]}),a.type&&e.jsx("p",{className:"text-sm text-destructive",children:a.type.message})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"module_id",children:"Module *"}),e.jsxs(A,{value:j("module_id")?.toString(),onValueChange:s=>c("module_id",parseInt(s)),disabled:t.isPending,children:[e.jsx(M,{children:e.jsx(Q,{placeholder:"Select a module"})}),e.jsx(I,{children:L.map(s=>e.jsx(f,{value:s.id.toString(),children:s.title},s.id))})]}),a.module_id&&e.jsx("p",{className:"text-sm text-destructive",children:a.module_id.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"position",children:"Position *"}),e.jsx(u,{id:"position",type:"number",min:"1",placeholder:"1",...o("position",{valueAsNumber:!0}),disabled:t.isPending}),a.position&&e.jsx("p",{className:"text-sm text-destructive",children:a.position.message})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"content_markdown",children:"Question Content (Markdown) *"}),e.jsx(P,{id:"content_markdown",placeholder:`**Choose the best answer:**

Which sentence is grammatically correct?`,rows:6,...o("content_markdown"),disabled:t.isPending}),a.content_markdown&&e.jsx("p",{className:"text-sm text-destructive",children:a.content_markdown.message})]}),b==="mcq"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{className:"text-base font-semibold",children:"Answer Choices *"}),e.jsxs(l,{type:"button",variant:"outline",size:"sm",onClick:()=>H({label:String.fromCharCode(65+g.length),content_markdown:""}),disabled:t.isPending,children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Add Choice"]})]}),e.jsx("div",{className:"space-y-3",children:g.map((s,i)=>e.jsxs("div",{className:"flex gap-3",children:[e.jsx(u,{placeholder:"A",...o(`choices.${i}.label`),className:"w-20",disabled:t.isPending}),e.jsx(u,{placeholder:"Choice content",...o(`choices.${i}.content_markdown`),className:"flex-1",disabled:t.isPending}),g.length>2&&e.jsx(l,{type:"button",variant:"outline",size:"sm",onClick:()=>B(i),disabled:t.isPending,children:e.jsx(F,{className:"h-4 w-4"})})]},s.id))}),a.choices&&e.jsx("p",{className:"text-sm text-destructive",children:a.choices.message})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{className:"text-base font-semibold",children:"Correct Answer(s) *"}),e.jsxs(l,{type:"button",variant:"outline",size:"sm",onClick:()=>w([...d,""]),disabled:t.isPending,children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Add Answer"]})]}),e.jsx("div",{className:"space-y-3",children:d.map((s,i)=>e.jsxs("div",{className:"flex gap-3",children:[e.jsx(u,{placeholder:b==="mcq"?"A":"4",value:s,onChange:x=>{const p=[...d];p[i]=x.target.value,w(p),c("answer",p)},className:"flex-1",disabled:t.isPending}),d.length>1&&e.jsx(l,{type:"button",variant:"outline",size:"sm",onClick:()=>{const x=d.filter((p,D)=>D!==i);w(x),c("answer",x)},disabled:t.isPending,children:e.jsx(F,{className:"h-4 w-4"})})]},i))}),a.answer&&e.jsx("p",{className:"text-sm text-destructive",children:a.answer.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"explanation_markdown",children:"Explanation (Optional)"}),e.jsx(P,{id:"explanation_markdown",placeholder:"The correct answer is A because...",rows:4,...o("explanation_markdown"),disabled:t.isPending}),a.explanation_markdown&&e.jsx("p",{className:"text-sm text-destructive",children:a.explanation_markdown.message})]}),e.jsxs("div",{className:"flex items-center justify-end gap-4 pt-6 border-t",children:[e.jsx(l,{type:"button",variant:"outline",onClick:C,disabled:t.isPending,children:"Cancel"}),e.jsx(l,{type:"submit",disabled:t.isPending,className:"min-w-[140px]",children:t.isPending?"Creating...":e.jsxs(e.Fragment,{children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),"Create Question"]})})]})]})})]})]})]})}const fe=[{title:"Tests",href:"/tests/tests",isActive:!1,disabled:!1},{title:"Modules",href:"/tests/modules",isActive:!1,disabled:!1},{title:"Questions",href:"/tests/questions",isActive:!0,disabled:!1}],Te=be;export{Te as component};
