import{r as f,e as F,o as V,t as S,j as e,B as p,n as D,s as L,u as Y,k as J}from"./index-F_r_DwTH.js";import{a as T,u as E,T as X,M as Z}from"./top-nav-DvRblSZy.js";import{I as C}from"./input-DMn3TbYb.js";import{S as _,a as k,b as Q,c as K,d as P}from"./select-DGKpCF8p.js";import{B as q}from"./badge-DwZHM-eA.js";import{H as ee,S as se,T as te,C as ie,P as ae}from"./config-drawer-BpM_6BIu.js";import{m as M}from"./modules-api-Dus87-JM.js";import{t as O}from"./tests-api-DMkA4dYV.js";import{u as z,a as R,L as b}from"./label-BnG0ayX7.js";import{N as B,$ as le,O as W,Q as $,R as H,T as I,W as U,D as ne,j as re,k as oe,n as A,m as de,a0 as ce,a1 as ue,a2 as me,a3 as he,a4 as xe,a5 as ge,a6 as pe,a7 as je}from"./sign-out-dialog-XajWXyhp.js";import{P as G}from"./plus-Bql6OQ1N.js";import{E as fe,S as ve,T as ye}from"./trash-2-PlYNF6uo.js";import{E as Ne}from"./eye-pjOTwaeO.js";import{D as be}from"./download-BWAAQZsN.js";import"./createLucideIcon-C0SHlZwQ.js";const Se=V({title:L().min(1,"Title is required").max(200,"Title must be less than 200 characters"),position:D().min(1,"Position must be at least 1"),test_id:D().min(1,"Test is required")});function Ce({children:a,defaultTestId:c,onSuccess:j}){const[v,h]=f.useState(!1),x=F(),{register:u,handleSubmit:n,formState:{errors:i},reset:r,setValue:m,watch:g}=z({resolver:R(Se),defaultValues:{position:1,test_id:c||void 0}}),{data:o=[]}=T({queryKey:["tests"],queryFn:()=>O.list()});f.useEffect(()=>{c&&m("test_id",c)},[c,m]);const d=E({mutationFn:t=>M.create(t),onSuccess:t=>{S.success(`Module "${t.title}" created successfully!`),x.invalidateQueries({queryKey:["modules"]}),x.invalidateQueries({queryKey:["test-modules"]}),h(!1),r(),j?.()},onError:t=>{const N=t.response?.data?.detail||"Failed to create module. Please try again.";S.error(N)}}),y=t=>{d.mutate(t)},s=t=>{t||r({position:1,test_id:c||void 0}),h(t)};return e.jsxs(B,{open:v,onOpenChange:s,children:[e.jsx(le,{asChild:!0,children:a}),e.jsxs(W,{className:"sm:max-w-md",children:[e.jsxs($,{children:[e.jsx(H,{children:"Create New Module"}),e.jsx(I,{children:"Create a new module within a test. Modules organize questions by subject (e.g., Reading & Writing, Math)."})]}),e.jsxs("form",{onSubmit:n(y),className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"title",children:"Module Title"}),e.jsx(C,{id:"title",placeholder:"Reading and Writing",...u("title"),disabled:d.isPending}),i.title&&e.jsx("p",{className:"text-sm text-destructive",children:i.title.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"test_id",children:"Test"}),e.jsxs(_,{value:g("test_id")?.toString(),onValueChange:t=>m("test_id",parseInt(t)),disabled:d.isPending||!!c,children:[e.jsx(k,{children:e.jsx(Q,{placeholder:"Select a test"})}),e.jsx(K,{children:o.map(t=>e.jsx(P,{value:t.id.toString(),children:t.title},t.id))})]}),i.test_id&&e.jsx("p",{className:"text-sm text-destructive",children:i.test_id.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"position",children:"Position"}),e.jsx(C,{id:"position",type:"number",min:"1",placeholder:"1",...u("position",{valueAsNumber:!0}),disabled:d.isPending}),i.position&&e.jsx("p",{className:"text-sm text-destructive",children:i.position.message})]}),e.jsxs(U,{children:[e.jsx(p,{type:"button",variant:"outline",onClick:()=>h(!1),disabled:d.isPending,children:"Cancel"}),e.jsx(p,{type:"submit",disabled:d.isPending,children:d.isPending?"Creating...":"Create Module"})]})]})]})]})}const Me=V({title:L().min(1,"Title is required").max(200,"Title must be less than 200 characters"),position:D().min(1,"Position must be at least 1"),test_id:D().min(1,"Test is required")});function we({module:a,open:c,onOpenChange:j,onSuccess:v}){const h=F(),{register:x,handleSubmit:u,formState:{errors:n},reset:i,setValue:r,watch:m}=z({resolver:R(Me)}),{data:g=[]}=T({queryKey:["tests"],queryFn:()=>O.list()});f.useEffect(()=>{a&&(r("title",a.title),r("position",a.position),r("test_id",a.test_id))},[a,r]);const o=E({mutationFn:s=>{if(!a)throw new Error("No module selected");return M.update(a.id,s)},onSuccess:s=>{S.success(`Module "${s.title}" updated successfully!`),h.invalidateQueries({queryKey:["modules"]}),h.invalidateQueries({queryKey:["test-modules"]}),j(!1),v?.()},onError:s=>{const t=s.response?.data?.detail||"Failed to update module. Please try again.";S.error(t)}}),d=s=>{o.mutate(s)},y=s=>{s||i(),j(s)};return a?e.jsx(B,{open:c,onOpenChange:y,children:e.jsxs(W,{className:"sm:max-w-md",children:[e.jsxs($,{children:[e.jsx(H,{children:"Edit Module"}),e.jsx(I,{children:"Update the module information. Changes will be saved immediately."})]}),e.jsxs("form",{onSubmit:u(d),className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"title",children:"Module Title"}),e.jsx(C,{id:"title",placeholder:"Reading and Writing",...x("title"),disabled:o.isPending}),n.title&&e.jsx("p",{className:"text-sm text-destructive",children:n.title.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"test_id",children:"Test"}),e.jsxs(_,{value:m("test_id")?.toString(),onValueChange:s=>r("test_id",parseInt(s)),disabled:o.isPending,children:[e.jsx(k,{children:e.jsx(Q,{placeholder:"Select a test"})}),e.jsx(K,{children:g.map(s=>e.jsx(P,{value:s.id.toString(),children:s.title},s.id))})]}),n.test_id&&e.jsx("p",{className:"text-sm text-destructive",children:n.test_id.message})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"position",children:"Position"}),e.jsx(C,{id:"position",type:"number",min:"1",placeholder:"1",...x("position",{valueAsNumber:!0}),disabled:o.isPending}),n.position&&e.jsx("p",{className:"text-sm text-destructive",children:n.position.message})]}),e.jsxs(U,{children:[e.jsx(p,{type:"button",variant:"outline",onClick:()=>j(!1),disabled:o.isPending,children:"Cancel"}),e.jsx(p,{type:"submit",disabled:o.isPending,children:o.isPending?"Updating...":"Update Module"})]})]})]})}):null}function De({data:a,tests:c,isLoading:j,onEdit:v,onViewQuestions:h,onRefresh:x}){const[u,n]=f.useState(!1),[i,r]=f.useState(null),m=F(),g=E({mutationFn:s=>M.delete(s),onSuccess:(s,t)=>{const N=a.find(w=>w.id===t)?.title||"Module";S.success(`${N} deleted successfully`),m.invalidateQueries({queryKey:["modules"]}),m.invalidateQueries({queryKey:["test-modules"]}),n(!1),r(null),x()},onError:s=>{const t=s.response?.data?.detail||"Failed to delete module. Please try again.";S.error(t)}}),o=s=>{r(s),n(!0)},d=()=>{i&&g.mutate(i.id)},y=s=>c.find(t=>t.id===s)?.title||`Test #${s}`;return j?e.jsx("div",{className:"text-center py-12",children:e.jsx("div",{className:"text-muted-foreground",children:"Loading modules..."})}):a.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-muted-foreground mb-4",children:"No modules found."}),e.jsxs(p,{onClick:x,children:[e.jsx(G,{className:"mr-2 h-4 w-4"}),"Create Your First Module"]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:a.map(s=>e.jsxs("div",{className:"border rounded-xl p-6 hover:shadow-lg transition-all duration-200 bg-card",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:y(s.test_id)}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{variant:"default",children:"Active"}),e.jsxs(q,{variant:"outline",children:["Position ",s.position]})]})]}),e.jsxs(ne,{children:[e.jsx(re,{asChild:!0,children:e.jsxs(p,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(fe,{className:"h-4 w-4"})]})}),e.jsxs(oe,{align:"end",children:[e.jsxs(A,{onClick:()=>h(s),children:[e.jsx(Ne,{className:"mr-2 h-4 w-4"}),"View Questions"]}),e.jsxs(A,{onClick:()=>v(s),children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsx(de,{}),e.jsxs(A,{onClick:()=>o(s),className:"text-destructive",children:[e.jsx(ye,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})]}),e.jsx("div",{className:"space-y-3 mb-6",children:e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Module containing questions for ",s.title.toLowerCase()," section of the SAT test"]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>h(s),children:"View Questions"}),e.jsx(p,{variant:"outline",size:"sm",onClick:()=>v(s),children:"Edit"})]})]},s.id))}),e.jsx(ce,{open:u,onOpenChange:n,children:e.jsxs(ue,{children:[e.jsxs(me,{children:[e.jsx(he,{children:"Delete Module"}),e.jsxs(xe,{children:['Are you sure you want to delete "',i?.title,'"? This will perform a soft delete and the module can be restored later.']})]}),e.jsxs(ge,{children:[e.jsx(pe,{disabled:g.isPending,children:"Cancel"}),e.jsx(je,{onClick:d,disabled:g.isPending,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:g.isPending?"Deleting...":"Delete"})]})]})})]})}function Te(){const a=Y(),c=J({strict:!1}),[j,v]=f.useState(null),[h,x]=f.useState(!1),[u,n]=f.useState(""),[i,r]=f.useState(c.testId||"all"),{data:m=[]}=T({queryKey:["tests"],queryFn:()=>O.list()}),{data:g=[],isLoading:o,refetch:d}=T({queryKey:["modules",i],queryFn:()=>i==="all"?M.list():M.getByTestId(parseInt(i))}),y=g.filter(l=>l.title.toLowerCase().includes(u.toLowerCase())),s=l=>{v(l),x(!0)},t=l=>{a({to:"/tests/questions",search:{moduleId:l.id.toString()}})},N=()=>{d()},w=l=>{r(l),a(l!=="all"?{to:"/tests/modules",search:{testId:l}}:{to:"/tests/modules",search:{}})};return e.jsxs(e.Fragment,{children:[e.jsxs(ee,{children:[e.jsx(X,{links:Pe}),e.jsxs("div",{className:"ms-auto flex items-center space-x-4",children:[e.jsx(se,{}),e.jsx(te,{}),e.jsx(ie,{}),e.jsx(ae,{})]})]}),e.jsxs(Z,{children:[e.jsxs("div",{className:"mb-6 flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight bg-gradient-to-r from-primary to-primary/70 bg-clip-text text-transparent",children:"Modules Management"}),e.jsx("p",{className:"text-muted-foreground text-lg",children:"Organize test content into modules like Reading & Writing, Math, etc."})]}),e.jsx("div",{className:"flex items-center space-x-3",children:e.jsx(Ce,{defaultTestId:i!=="all"?parseInt(i):void 0,onSuccess:N,children:e.jsxs(p,{size:"lg",className:"bg-gradient-to-r from-primary to-primary/90 hover:from-primary/90 hover:to-primary/80 shadow-lg hover:shadow-xl transition-all duration-200",children:[e.jsx(G,{className:"mr-2 h-5 w-5"}),"Add Module"]})})})]}),e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center mb-6",children:[e.jsx("div",{className:"flex-1",children:e.jsx(C,{placeholder:"Search modules...",value:u,onChange:l=>n(l.target.value),className:"w-full"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(_,{value:i,onValueChange:w,children:[e.jsx(k,{className:"w-[160px]",children:e.jsx(Q,{placeholder:"All Tests"})}),e.jsxs(K,{children:[e.jsx(P,{value:"all",children:"All Tests"}),m.map(l=>e.jsx(P,{value:l.id.toString(),children:l.title},l.id))]})]}),e.jsxs(p,{variant:"outline",size:"sm",children:[e.jsx(be,{className:"h-4 w-4"}),"Export"]})]})]}),(u||i!=="all")&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-6",children:[e.jsxs("span",{children:["Showing ",y.length," of ",g.length," modules"]}),u&&e.jsxs(q,{variant:"secondary",children:['Search: "',u,'"']}),i!=="all"&&e.jsxs(q,{variant:"secondary",children:["Test: ",m.find(l=>l.id.toString()===i)?.title]}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>{n(""),w("all")},children:"Clear filters"})]}),e.jsx(De,{data:y,tests:m,isLoading:o,onEdit:s,onViewQuestions:t,onRefresh:N})]}),e.jsx(we,{module:j,open:h,onOpenChange:x,onSuccess:N})]})}const Pe=[{title:"Tests",href:"/tests/tests",isActive:!1,disabled:!1},{title:"Modules",href:"/tests/modules",isActive:!0,disabled:!1},{title:"Questions",href:"/tests/questions",isActive:!1,disabled:!1}],$e=Te;export{$e as component};
