import{r as j,e as le,t as f,j as e,B as m,c as G,u as Re,k as Be}from"./index-F_r_DwTH.js";import{a as se,u as pe,T as Ce,M as Se}from"./top-nav-DvRblSZy.js";import{C as E,a as te,b as ae,c as re,d as T}from"./card-BV_eUoeD.js";import{I as H}from"./input-DMn3TbYb.js";import{N as ge,$ as qe,O as fe,Q as Ne,R as ve,Y as z,T as be,W as ye,a9 as X,a8 as Qe,D as Ke,j as Ue,k as Ve,l as ze,n as oe,m as He,M as We,X as Y,A as de,s as me,t as xe,aa as Ge,ab as Xe,ac as Ye,ad as Ze,ae as es,af as ss}from"./sign-out-dialog-XajWXyhp.js";import{T as ts,a as as,b as Z,c as ee,C as rs,d as he,e as ue,P as ns,H as ls,f as is,g as cs,h as os}from"./tabs-D5SkWEle.js";import{B as ne}from"./badge-DwZHM-eA.js";import{H as Le,S as ke,T as De,C as Ie,P as Ee,a as ds}from"./config-drawer-BpM_6BIu.js";import{e as ms,a as $,C as xs,f as hs,b as us}from"./schema-MDXdXiQy.js";import{F as Me,f as F,h as O,i as P,j as q,k as M,T as js,a as ps,b as Te,c as R,d as gs,e as B,g as je,l as fs}from"./form-CE0wp8Cn.js";import{u as $e,a as Ae}from"./label-BnG0ayX7.js";import{T as we}from"./textarea-G6A4affv.js";import{S as Ns,a as vs,b as bs,c as ys,d as ws}from"./select-DGKpCF8p.js";import{S as _e,E as Cs,T as Ss}from"./trash-2-PlYNF6uo.js";import{F as Fe}from"./file-text-Bk8UfvQZ.js";import{D as Je}from"./download-BWAAQZsN.js";import{E as Ls}from"./eye-pjOTwaeO.js";import{C as ks}from"./chevrons-up-down-BvGMTdjo.js";import{P as Ds}from"./plus-Bql6OQ1N.js";import"./createLucideIcon-C0SHlZwQ.js";function Is({courseId:o,children:N,onSuccess:b}){const[C,v]=j.useState(!1),l=le(),d=$e({resolver:Ae(ms),defaultValues:{title:"",content:"",order:1}}),{data:g,isLoading:a}=se({queryKey:["courses"],queryFn:()=>$.courses.list(),enabled:!o}),p=pe({mutationFn:i=>$.lessons.create(i.courseId,i),onSuccess:()=>{f.success("Lesson created successfully"),l.invalidateQueries({queryKey:["lessons"]}),l.invalidateQueries({queryKey:["courses"]}),d.reset(),v(!1),b?.()},onError:i=>{f.error("Failed to create lesson"),console.error("Create lesson error:",i)}}),x=i=>{const c=o||parseInt(d.watch("courseId"));if(!c){f.error("Please select a course");return}p.mutate({...i,courseId:c})};return e.jsxs(ge,{open:C,onOpenChange:v,children:[e.jsx(qe,{asChild:!0,children:N||e.jsxs(m,{children:[e.jsx(xs,{className:"h-4 w-4"}),"Add Lesson"]})}),e.jsxs(fe,{className:"sm:max-w-[700px]",children:[e.jsxs(Ne,{children:[e.jsxs(ve,{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-5 w-5"}),"Create New Lesson"]}),e.jsx(be,{children:"Add a new lesson to organize educational content and words."})]}),e.jsx(Me,{...d,children:e.jsxs("form",{onSubmit:d.handleSubmit(x),className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4",children:[!o&&e.jsx(F,{control:d.control,name:"courseId",render:({field:i})=>e.jsxs(O,{children:[e.jsx(P,{children:"Course *"}),e.jsxs(Ns,{onValueChange:c=>i.onChange(parseInt(c)),value:i.value?.toString(),disabled:a,children:[e.jsx(q,{children:e.jsx(vs,{children:e.jsx(bs,{placeholder:"Select a course"})})}),e.jsx(ys,{children:g?.map(c=>e.jsx(ws,{value:c.id.toString(),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${c.is_active?"bg-green-500":"bg-red-500"}`}),c.title]})},c.id))})]}),e.jsx(M,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsx(F,{control:d.control,name:"title",render:({field:i})=>e.jsxs(O,{children:[e.jsx(P,{children:"Lesson Title *"}),e.jsx(q,{children:e.jsx(H,{placeholder:"e.g., Greetings and Introductions",...i})}),e.jsx(M,{})]})})}),e.jsx("div",{children:e.jsx(F,{control:d.control,name:"order",render:({field:i})=>e.jsxs(O,{children:[e.jsx(P,{children:"Order *"}),e.jsx(q,{children:e.jsx(H,{type:"number",min:"1",placeholder:"1",...i,onChange:c=>i.onChange(parseInt(c.target.value)||1)})}),e.jsx(M,{})]})})})]}),e.jsx(F,{control:d.control,name:"content",render:({field:i})=>e.jsxs(O,{children:[e.jsx(P,{children:"Lesson Content *"}),e.jsx(q,{children:e.jsx(we,{placeholder:"Describe the lesson objectives, key concepts, and learning outcomes...",className:"min-h-[150px]",...i})}),e.jsx(M,{})]})})]}),e.jsxs(ye,{children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>v(!1),children:"Cancel"}),e.jsx(m,{type:"submit",disabled:p.isPending,className:"min-w-[100px]",children:p.isPending?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Creating..."]}):"Create Lesson"})]})]})})]})]})}function Es({lesson:o,open:N,onOpenChange:b,onSuccess:C}){const v=le(),l=$e({resolver:Ae(hs),defaultValues:{title:"",content:"",order:1}}),d=pe({mutationFn:a=>{if(!o)throw new Error("No lesson selected");return $.lessons.update(o.id,a)},onSuccess:()=>{f.success("Lesson updated successfully"),v.invalidateQueries({queryKey:["lessons"]}),v.invalidateQueries({queryKey:["courses"]}),b(!1),C?.()},onError:a=>{f.error("Failed to update lesson"),console.error("Update lesson error:",a)}});j.useEffect(()=>{o&&l.reset({title:o.title,content:o.content,order:o.order})},[o,l]);const g=a=>{d.mutate(a)};return o?e.jsx(ge,{open:N,onOpenChange:b,children:e.jsxs(fe,{className:"sm:max-w-[700px]",children:[e.jsxs(Ne,{children:[e.jsxs(ve,{className:"flex items-center gap-2",children:[e.jsx(_e,{className:"h-5 w-5"}),"Edit Lesson"]}),e.jsx(be,{children:"Update the lesson information and content."})]}),e.jsx(Me,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(g),className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsx(F,{control:l.control,name:"title",render:({field:a})=>e.jsxs(O,{children:[e.jsx(P,{children:"Lesson Title *"}),e.jsx(q,{children:e.jsx(H,{placeholder:"e.g., Greetings and Introductions",...a})}),e.jsx(M,{})]})})}),e.jsx("div",{children:e.jsx(F,{control:l.control,name:"order",render:({field:a})=>e.jsxs(O,{children:[e.jsx(P,{children:"Order *"}),e.jsx(q,{children:e.jsx(H,{type:"number",min:"1",placeholder:"1",...a,onChange:p=>a.onChange(parseInt(p.target.value)||1)})}),e.jsx(M,{})]})})})]}),e.jsx(F,{control:l.control,name:"content",render:({field:a})=>e.jsxs(O,{children:[e.jsx(P,{children:"Lesson Content *"}),e.jsx(q,{children:e.jsx(we,{placeholder:"Describe the lesson objectives, key concepts, and learning outcomes...",className:"min-h-[150px]",...a})}),e.jsx(M,{})]})}),e.jsxs("div",{className:"bg-muted/50 border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(z,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium text-sm",children:"Current Course"})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:o.course_title||`Course ${o.course_id}`}),e.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:"Note: To move this lesson to a different course, please create a new lesson in the target course."})]})]}),e.jsxs(ye,{children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>b(!1),children:"Cancel"}),e.jsx(m,{type:"submit",disabled:d.isPending,className:"min-w-[100px]",children:d.isPending?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Updating..."]}):"Update Lesson"})]})]})})]})}):null}const Oe=`[
  {
    "title": "Introduction to English",
    "content": "Welcome to our English course! In this first lesson, we'll cover the basics of English grammar and pronunciation.",
    "order": 1
  },
  {
    "title": "Basic Greetings",
    "content": "Learn common greetings and how to introduce yourself in English. Practice saying hello, goodbye, and asking how someone is doing.",
    "order": 2
  },
  {
    "title": "Numbers and Counting",
    "content": "Master numbers 1-100 in English. Learn how to count, tell time, and express quantities in everyday situations.",
    "order": 3
  },
  {
    "title": "Family and Relationships",
    "content": "Vocabulary for describing family members and relationships. Learn to talk about your family tree and close friends.",
    "order": 4
  },
  {
    "title": "Daily Activities",
    "content": "Common verbs and phrases for daily routines. Practice describing what you do from morning to night.",
    "order": 5
  }
]`;function Ts({courseId:o,courseName:N,children:b,onSuccess:C}){const[v,l]=j.useState(!1),[d,g]=j.useState(""),[a,p]=j.useState([]),[x,i]=j.useState([]),[,c]=j.useState(!1),[y,r]=j.useState([]),[h,D]=j.useState("input"),[Q,A]=j.useState(0),W=le(),ie=s=>{const t=[];if(!s.trim())return t.push("JSON input is required"),{valid:!1,errors:t};try{const u=JSON.parse(s);if(!Array.isArray(u))return t.push("JSON must be an array of lesson objects"),{valid:!1,errors:t};if(u.length===0)return t.push("Array cannot be empty"),{valid:!1,errors:t};if(u.length>50)return t.push("Maximum 50 lessons allowed per bulk creation"),{valid:!1,errors:t};const w=[],S=new Set;return u.forEach((L,I)=>{if(typeof L!="object"||L===null){t.push(`Item ${I+1}: Must be an object`);return}const{title:U,content:V,order:k}=L;!U||typeof U!="string"?t.push(`Item ${I+1}: "title" is required and must be a string`):U.length>200&&t.push(`Item ${I+1}: "title" must be less than 200 characters`),!V||typeof V!="string"?t.push(`Item ${I+1}: "content" is required and must be a string`):V.length>5e3&&t.push(`Item ${I+1}: "content" must be less than 5000 characters`),typeof k!="number"||k<1?t.push(`Item ${I+1}: "order" must be a positive number`):S.has(k)?t.push(`Item ${I+1}: "order" ${k} is duplicated`):S.add(k),U&&V&&typeof k=="number"&&k>=1&&w.push({title:U.trim(),content:V.trim(),order:k})}),{valid:t.length===0,lessons:w,errors:t}}catch(u){return t.push("Invalid JSON format: "+u.message),{valid:!1,errors:t}}},_=()=>{const{valid:s,lessons:t,errors:u}=ie(d);p(u),s&&t&&(i(t),D("preview"))},ce=async()=>{D("creating"),c(!0),A(0);const s=[];for(let w=0;w<x.length;w++){const S=x[w];try{const L=await $.lessons.create(o,{title:S.title,content:S.content,order:S.order});s.push({lesson:S,success:!0,id:L.id}),f.success(`Created lesson: ${S.title}`)}catch(L){s.push({lesson:S,success:!1,error:L instanceof Error?L.message:"Unknown error"}),f.error(`Failed to create lesson: ${S.title}`)}A((w+1)/x.length*100),r([...s])}c(!1),D("results"),W.invalidateQueries({queryKey:["lessons"]}),W.invalidateQueries({queryKey:["courses"]});const t=s.filter(w=>w.success).length,u=s.filter(w=>!w.success).length;t>0&&f.success(`Successfully created ${t} lesson${t>1?"s":""}`),u>0&&f.error(`Failed to create ${u} lesson${u>1?"s":""}`),C?.()},J=()=>{D("input"),g(""),p([]),i([]),r([]),A(0)},K=()=>{navigator.clipboard.writeText(Oe),f.success("Example JSON copied to clipboard")},n=()=>{const s=new Blob([Oe],{type:"application/json"}),t=URL.createObjectURL(s),u=document.createElement("a");u.href=t,u.download="lessons-example.json",document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(t),f.success("Example JSON downloaded")};return e.jsxs(ge,{open:v,onOpenChange:l,children:[e.jsx(qe,{asChild:!0,children:b||e.jsxs(m,{variant:"outline",children:[e.jsx(Fe,{className:"h-4 w-4"}),"Bulk Create (JSON)"]})}),e.jsxs(fe,{className:"sm:max-w-[900px] max-h-[90vh] flex flex-col",children:[e.jsxs(Ne,{children:[e.jsxs(ve,{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"h-5 w-5"}),'Bulk Create Lessons for "',N,'"']}),e.jsx(be,{children:"Create multiple lessons at once using JSON format. Each lesson will be created individually."})]}),e.jsxs(ts,{value:h,className:"w-full flex-1 flex flex-col overflow-hidden",children:[e.jsxs(as,{className:"grid w-full grid-cols-4",children:[e.jsx(Z,{value:"input",disabled:h==="creating",className:G(h==="input"&&"bg-primary text-primary-foreground",["preview","creating","results"].includes(h)&&"bg-muted"),children:"1. JSON Input"}),e.jsx(Z,{value:"preview",disabled:h==="creating"||x.length===0,className:G(h==="preview"&&"bg-primary text-primary-foreground",["creating","results"].includes(h)&&"bg-muted"),children:"2. Preview"}),e.jsx(Z,{value:"creating",disabled:!0,className:G(h==="creating"&&"bg-primary text-primary-foreground",h==="results"&&"bg-muted"),children:"3. Creating..."}),e.jsx(Z,{value:"results",disabled:y.length===0,className:G(h==="results"&&"bg-primary text-primary-foreground"),children:"4. Results"})]}),e.jsx(ee,{value:"input",className:"space-y-4 flex-1 overflow-y-auto",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Lessons JSON Array"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(m,{variant:"ghost",size:"sm",onClick:K,children:[e.jsx(rs,{className:"h-3 w-3 mr-1"}),"Copy Example"]}),e.jsxs(m,{variant:"ghost",size:"sm",onClick:n,children:[e.jsx(Je,{className:"h-3 w-3 mr-1"}),"Download Example"]})]})]}),e.jsx(we,{value:d,onChange:s=>g(s.target.value),placeholder:"Paste your JSON array here...",className:"min-h-[300px] max-h-[400px] font-mono text-sm resize-none"})]}),a.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-600",children:[e.jsx(he,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Validation Errors:"})]}),e.jsx(X,{className:"max-h-[100px]",children:e.jsx("ul",{className:"space-y-1 text-sm text-red-600",children:a.map((s,t)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-red-400 mt-0.5",children:"•"}),s]},t))})})]}),e.jsxs("div",{className:"bg-muted/50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium mb-2",children:"JSON Format Requirements:"}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsx("li",{children:"• Must be a valid JSON array"}),e.jsx("li",{children:'• Each object requires: "title", "content", "order"'}),e.jsx("li",{children:"• Title: max 200 characters"}),e.jsx("li",{children:"• Content: max 5000 characters"}),e.jsx("li",{children:"• Order: positive number, unique per lesson"}),e.jsx("li",{children:"• Maximum 50 lessons per bulk operation"})]})]})]})}),e.jsx(ee,{value:"preview",className:"space-y-4 flex-1 overflow-y-auto",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-5 w-5 text-green-600"}),e.jsxs("span",{className:"font-medium",children:["Ready to create ",x.length," lesson",x.length>1?"s":""]})]}),e.jsx(X,{className:"flex-1 max-h-[400px]",children:e.jsx("div",{className:"space-y-3",children:x.map((s,t)=>e.jsxs("div",{className:"border rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs(ne,{variant:"outline",children:["#",s.order]}),e.jsx("span",{className:"font-medium",children:s.title})]}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:s.content})]},t))})})]})}),e.jsx(ee,{value:"creating",className:"space-y-4 flex-1 overflow-y-auto",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Creating lessons..."}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[Math.round(Q),"% complete (",y.length," of ",x.length,")"]})]}),e.jsx(ns,{value:Q,className:"w-full"}),y.length>0&&e.jsx(X,{className:"max-h-[300px]",children:e.jsx("div",{className:"space-y-2 text-left",children:y.map((s,t)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.success?e.jsx(ue,{className:"h-4 w-4 text-green-600"}):e.jsx(he,{className:"h-4 w-4 text-red-600"}),e.jsx("span",{className:s.success?"text-green-600":"text-red-600",children:s.lesson.title})]},t))})})]})}),e.jsx(ee,{value:"results",className:"space-y-4 flex-1 overflow-y-auto",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-green-50 dark:bg-green-950 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:y.filter(s=>s.success).length}),e.jsx("div",{className:"text-sm text-green-600",children:"Successful"})]}),e.jsxs("div",{className:"text-center p-4 bg-red-50 dark:bg-red-950 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:y.filter(s=>!s.success).length}),e.jsx("div",{className:"text-sm text-red-600",children:"Failed"})]})]}),e.jsx(X,{className:"flex-1 max-h-[400px]",children:e.jsx("div",{className:"space-y-2",children:y.map((s,t)=>e.jsxs("div",{className:"flex items-start gap-3 p-2 rounded border",children:[s.success?e.jsx(ue,{className:"h-4 w-4 text-green-600 mt-0.5"}):e.jsx(he,{className:"h-4 w-4 text-red-600 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-sm",children:s.lesson.title}),s.error&&e.jsx("div",{className:"text-xs text-red-600 mt-1",children:s.error}),s.success&&s.id&&e.jsxs("div",{className:"text-xs text-green-600 mt-1",children:["Created with ID: ",s.id]})]})]},t))})})]})})]}),e.jsxs(ye,{children:[h==="input"&&e.jsxs(e.Fragment,{children:[e.jsx(m,{variant:"outline",onClick:()=>l(!1),children:"Cancel"}),e.jsx(m,{onClick:_,disabled:!d.trim(),children:"Validate & Preview"})]}),h==="preview"&&e.jsxs(e.Fragment,{children:[e.jsx(m,{variant:"outline",onClick:()=>D("input"),children:"Back"}),e.jsxs(m,{onClick:ce,disabled:x.length===0,children:["Create ",x.length," Lesson",x.length>1?"s":""]})]}),h==="creating"&&e.jsxs(m,{disabled:!0,children:["Creating... ",Math.round(Q),"%"]}),h==="results"&&e.jsxs(e.Fragment,{children:[e.jsx(m,{variant:"outline",onClick:J,children:"Create More"}),e.jsx(m,{onClick:()=>l(!1),children:"Done"})]})]})]})]})}function Fs({data:o,isLoading:N,onEdit:b,onViewWords:C,onRefresh:v,courseName:l}){const[d,g]=j.useState(!1),[a,p]=j.useState(null),x=le(),i=pe({mutationFn:r=>$.lessons.delete(r),onSuccess:r=>{f.success(r.message),x.invalidateQueries({queryKey:["lessons"]}),x.invalidateQueries({queryKey:["courses"]}),v(),g(!1),p(null)},onError:r=>{f.error("Failed to delete lesson"),console.error("Delete error:",r)}}),c=r=>{p(r),g(!0)},y=()=>{a&&i.mutate(a.id)};return N?e.jsxs(E,{children:[e.jsxs(te,{children:[e.jsx(ae,{children:"Lessons"}),e.jsx(re,{children:"Loading..."})]}),e.jsx(T,{children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})]}):o.length===0?e.jsxs(E,{children:[e.jsxs(te,{children:[e.jsx(ae,{children:"Lessons"}),e.jsx(re,{children:l?`No lessons found in "${l}"`:"No lessons found"})]}),e.jsx(T,{children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(z,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsxs("p",{className:"text-muted-foreground text-center",children:[l?`No lessons have been created for "${l}" yet.`:"No lessons have been created yet.",e.jsx("br",{}),'Click "Add Lesson" to get started.']})]})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(E,{className:"border-0 shadow-lg bg-gradient-to-br from-card via-card to-card/95",children:[e.jsx(te,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(ae,{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(z,{className:"h-5 w-5 text-primary"}),"Lessons (",o.length,")",l&&e.jsx(ne,{variant:"outline",className:"ml-2",children:l})]}),e.jsx(re,{className:"mt-1",children:l?`Manage lessons for "${l}" course`:"Manage educational lessons and their content"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Words"}),e.jsx("div",{className:"text-2xl font-bold text-primary",children:o.reduce((r,h)=>r+(h.words_count||0),0)})]})]})}),e.jsx(T,{children:e.jsxs(js,{children:[e.jsx(ps,{children:e.jsxs(Te,{children:[e.jsx(R,{children:"Lesson"}),e.jsx(R,{children:"Course"}),e.jsx(R,{children:"Words"}),e.jsx(R,{children:"Order"}),e.jsx(R,{children:"Created"}),e.jsx(R,{className:"w-[70px]",children:"Actions"})]})}),e.jsx(gs,{children:o.map(r=>e.jsxs(Te,{children:[e.jsx(B,{className:"max-w-[300px]",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-medium truncate",title:r.title,children:r.title}),e.jsx("div",{className:"text-sm text-muted-foreground line-clamp-1",title:r.content,children:r.content})]})}),e.jsx(B,{className:"max-w-[200px]",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("div",{className:"min-w-0 flex-1",children:e.jsx("div",{className:"font-medium text-sm truncate",title:r.course_title||`Course ${r.course_id}`,children:r.course_title||`Course ${r.course_id}`})})]})}),e.jsx(B,{children:e.jsx(m,{variant:"ghost",size:"sm",className:"h-auto p-1 hover:bg-muted/50",onClick:()=>C(r),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Words"})]})})}),e.jsx(B,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ls,{className:"h-3 w-3 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-mono",children:r.order})]})}),e.jsx(B,{children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(us,{className:"h-3 w-3"}),new Date(r.created_at).toLocaleDateString()]})}),e.jsx(B,{children:e.jsxs(Ke,{children:[e.jsx(Ue,{asChild:!0,children:e.jsxs(m,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(Cs,{className:"h-4 w-4"})]})}),e.jsxs(Ve,{align:"end",children:[e.jsx(ze,{children:"Actions"}),e.jsxs(oe,{onClick:()=>C(r),children:[e.jsx(Ls,{className:"mr-2 h-4 w-4"}),"View Words"]}),e.jsx(He,{}),e.jsxs(oe,{onClick:()=>b(r),children:[e.jsx(_e,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsxs(oe,{onClick:()=>c(r),className:"text-red-600",children:[e.jsx(Ss,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})})]},r.id))})]})})]}),e.jsx(We,{open:d,onOpenChange:g,title:"Delete Lesson",desc:`Are you sure you want to delete "${a?.title}"? This action cannot be undone and will also delete all associated words.`,confirmText:"Delete",handleConfirm:y,isLoading:i.isPending})]})}function Os(){const o=Re(),N=Be({from:"/_authenticated/content/lessons"}),[b,C]=j.useState(null),[v,l]=j.useState(!1),[d,g]=j.useState(""),[a,p]=j.useState(N.courseId?.toString()||""),[x,i]=j.useState(!1),{data:c=[],isLoading:y}=se({queryKey:["courses"],queryFn:()=>$.courses.list()}),{data:r=[]}=se({queryKey:["learning-centers"],queryFn:()=>fs.list()}),{data:h=[],isLoading:D,refetch:Q}=se({queryKey:["lessons",a],queryFn:()=>$.lessons.list({course_id:a?parseInt(a):void 0}),enabled:!!a});j.useEffect(()=>{N.courseId&&c.length>0&&p(N.courseId.toString())},[N.courseId,c]);const A=h.filter(n=>n.title.toLowerCase().includes(d.toLowerCase())||n.content.toLowerCase().includes(d.toLowerCase())),W=n=>{C(n),l(!0)},ie=n=>{o({to:"/content/words",search:{lessonId:n.id}})},_=()=>{Q()},ce=n=>{p(n),g(""),o({to:"/content/lessons",search:n?{courseId:parseInt(n)}:{}})},J=c.find(n=>n.id.toString()===a),K=r.find(n=>n.id===J?.learning_center_id);return a?e.jsxs(e.Fragment,{children:[e.jsxs(Le,{children:[e.jsx(Ce,{links:Pe}),e.jsxs("div",{className:"ms-auto flex items-center space-x-4",children:[e.jsx(ke,{}),e.jsx(De,{}),e.jsx(Ie,{}),e.jsx(Ee,{})]})]}),e.jsxs(Se,{children:[e.jsxs("div",{className:"mb-6 flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight bg-gradient-to-r from-primary to-primary/70 bg-clip-text text-transparent",children:"Lesson Management"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("p",{className:"text-muted-foreground text-lg",children:"Managing lessons for"}),K&&e.jsxs(de,{className:"h-5 w-5",children:[e.jsx(me,{src:je(K.logo||""),alt:K.name}),e.jsx(xe,{children:e.jsx(Y,{className:"h-3 w-3"})})]}),e.jsx(ne,{variant:"outline",children:J?.title})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(m,{variant:"outline",onClick:()=>p(""),children:"Change Course"}),e.jsx(Ts,{courseId:parseInt(a),courseName:J?.title||"Selected Course",onSuccess:_}),e.jsx(Is,{courseId:parseInt(a),onSuccess:_,children:e.jsxs(m,{size:"lg",className:"bg-gradient-to-r from-primary to-primary/90 hover:from-primary/90 hover:to-primary/80 shadow-lg hover:shadow-xl transition-all duration-200",children:[e.jsx(Ds,{className:"mr-2 h-5 w-5"}),"Add Lesson"]})})]})]}),e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center mb-6",children:[e.jsx("div",{className:"flex-1",children:e.jsx(H,{placeholder:"Search lessons...",value:d,onChange:n=>g(n.target.value),className:"w-full"})}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(m,{variant:"outline",size:"sm",children:[e.jsx(Je,{className:"h-4 w-4"}),"Export"]})})]}),d&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-6",children:[e.jsxs("span",{children:["Showing ",A.length," of ",h.length," lessons"]}),e.jsxs(ne,{variant:"secondary",children:['Search: "',d,'"']}),e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>g(""),children:"Clear search"})]}),e.jsx(Fs,{data:A,isLoading:D,onEdit:W,onViewWords:ie,onRefresh:_,courseName:J?.title})]}),e.jsx(Es,{lesson:b,open:v,onOpenChange:l,onSuccess:_})]}):e.jsxs(e.Fragment,{children:[e.jsxs(Le,{children:[e.jsx(Ce,{links:Pe}),e.jsxs("div",{className:"ms-auto flex items-center space-x-4",children:[e.jsx(ke,{}),e.jsx(De,{}),e.jsx(Ie,{}),e.jsx(Ee,{})]})]}),e.jsxs(Se,{children:[e.jsx("div",{className:"mb-6 flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight bg-gradient-to-r from-primary to-primary/70 bg-clip-text text-transparent",children:"Lesson Management"}),e.jsx("p",{className:"text-muted-foreground text-lg",children:"Select a course to view and manage its lessons"})]})}),e.jsxs(E,{className:"max-w-2xl mb-6",children:[e.jsxs(te,{children:[e.jsxs(ae,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-5 w-5"}),"Select Course"]}),e.jsx(re,{children:"Choose a course to manage its lessons and content"})]}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs(is,{open:x,onOpenChange:i,children:[e.jsx(cs,{asChild:!0,children:e.jsxs(m,{variant:"outline",role:"combobox","aria-expanded":x,className:"w-full justify-between",children:[a?(()=>{const n=c.find(t=>t.id.toString()===a),s=r.find(t=>t.id===n?.learning_center_id);return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(de,{className:"h-6 w-6",children:[e.jsx(me,{src:je(s?.logo||""),alt:s?.name}),e.jsx(xe,{children:e.jsx(Y,{className:"h-3 w-3"})})]}),e.jsx("span",{className:"truncate",children:n?.title})]})})():e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(Ge,{className:"h-4 w-4"}),e.jsx("span",{children:"Search courses..."})]}),e.jsx(ks,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(os,{className:"w-full p-0",children:e.jsxs(Xe,{children:[e.jsx(Ye,{placeholder:"Search courses..."}),e.jsx(Ze,{children:"No courses found."}),e.jsx(es,{children:c.map(n=>{const s=r.find(t=>t.id===n.learning_center_id);return e.jsx(ss,{value:`${n.title} ${s?.name||""}`,onSelect:()=>{ce(n.id.toString()),i(!1)},children:e.jsxs("div",{className:"flex items-center gap-3 w-full",children:[e.jsxs(de,{className:"h-8 w-8",children:[e.jsx(me,{src:je(s?.logo||""),alt:s?.name}),e.jsx(xe,{children:e.jsx(Y,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:n.title}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s?.name||`Center ${n.learning_center_id}`," • Lessons"]})]}),e.jsx(ds,{className:`ml-auto h-4 w-4 ${a===n.id.toString()?"opacity-100":"opacity-0"}`})]})},n.id)})})]})})]}),y&&e.jsxs("div",{className:"flex items-center justify-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"}),e.jsx("span",{className:"ml-2 text-sm text-muted-foreground",children:"Loading courses..."})]})]})]}),c.length>0&&e.jsxs("div",{className:"grid gap-4 md:grid-cols-3 max-w-2xl",children:[e.jsx(E,{children:e.jsxs(T,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold",children:c.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Courses"})]})}),e.jsx(E,{children:e.jsxs(T,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold",children:c.reduce((n,s)=>n+(s.lessons_count||0),0)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Lessons"})]})}),e.jsx(E,{children:e.jsxs(T,{className:"pt-6",children:[e.jsx("div",{className:"text-2xl font-bold",children:r.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Learning Centers"})]})})]})]})]})}const Pe=[{title:"Courses",href:"/content/courses",isActive:!1,disabled:!1},{title:"Lessons",href:"/content/lessons",isActive:!0,disabled:!1},{title:"Words",href:"/content/words",isActive:!1,disabled:!1}],et=Os;export{et as component};
